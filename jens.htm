<!doctype html>
<html lang="fa" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³ØªÙ‡Ø§</title>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');
        
        body {
            box-sizing: border-box;
            font-family: 'Vazirmatn', 'Vazir', 'Tahoma', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header h1::before {
            content: 'ğŸ“‹';
            font-size: 3rem;
        }
        
        .content {
            padding: 30px;
        }
        
        .folder-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .folder-section:hover {
            border-color: #FF6B6B;
            background: #fff5f5;
        }
        
        .folder-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .folder-input-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .folder-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .folder-button {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }
        
        .folder-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }
        
        .folder-info {
            color: #666;
            font-size: 0.85rem;
            margin: 0;
        }
        
        .completed-row {
            background-color: #d4edda !important;
        }
        
        .completed-row:hover {
            background-color: #c3e6cb !important;
        }
        
        .checkbox-cell {
            text-align: center;
            width: 50px;
        }
        
        .row-checkbox {
            transform: scale(1.2);
            cursor: pointer;
        }
        
        .description-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .description-btn:hover {
            background: #138496;
        }
        
        .description-column {
            width: 250px;
            min-width: 200px;
        }
        
        .description-text {
            white-space: pre-line;
            word-wrap: break-word;
            max-width: 200px;
            cursor: help;
            position: relative;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Tooltip */
        .description-text:hover::after {
            content: attr(data-fulltext);
            position: absolute;
            bottom: 100%;
            right: 0;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            white-space: pre-wrap;
            max-width: 300px;
            width: max-content;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 5px;
        }
        
        .description-text:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            right: 20px;
            border: 6px solid transparent;
            border-top-color: #333;
            margin-bottom: -1px;
        }
        
        .description-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        
        .modal-textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            resize: vertical;
        }
        
        .modal-buttons {
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .save-btn {
            background: #28a745;
            color: white;
        }
        
        .cancel-btn {
            background: #6c757d;
            color: white;
        }
        
        .price-cell {
            color: #28a745;
            font-weight: bold;
        }
        
        .files-section {
            background: white;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            overflow: hidden;
        }
        
        .files-header {
            background: #f5f5f5;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .files-header h2 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.5rem;
        }
        
        .filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-top: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
        }
        
        .search-box {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9rem;
            width: 200px;
        }
        
        .live-search-box {
            padding: 8px 15px;
            border: 1px solid #28a745;
            border-radius: 20px;
            font-size: 0.9rem;
            width: 200px;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.85rem;
            font-family: inherit;
            background: white;
            cursor: pointer;
            min-width: 120px;
        }
        
        .print-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .print-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .clear-filters-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        
        .clear-filters-button:hover {
            background: #5a6268;
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        th {
            background: #FF6B6B;
            color: white;
            padding: 15px 12px;
            text-align: right;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        th:hover {
            background: #FF5252;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            text-align: right;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        tr:hover {
            background: #fff5f5;
        }
        
        .file-icon {
            font-size: 1.2rem;
            margin-left: 8px;
        }
        
        .file-name {
            display: flex;
            align-items: center;
        }
        
        .file-size {
            color: #666;
            font-size: 0.85rem;
        }
        
        .file-date {
            color: #555;
            font-size: 0.85rem;
        }
        
        .no-files {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.1rem;
        }
        
        .folder-right {
            display: flex;
            gap: 10px;
        }
        
        .refresh-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .refresh-button:hover {
            background: #45a049;
            transform: translateY(-1px);
        }
        
        .clear-button {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .clear-button:hover {
            background: #d32f2f;
            transform: translateY(-1px);
        }
        
        .sort-indicator {
            margin-right: 5px;
            font-size: 0.8rem;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-right: 10px;
        }
        
        .status-online {
            background: #d4edda;
            color: #155724;
        }
        
        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            
            .header,
            .folder-section,
            .files-header,
            .content {
                display: none !important;
            }
            
            .files-section {
                border: none;
            }
            
            .table-container {
                max-height: none !important;
                overflow: visible !important;
            }
            
            .search-box,
            .live-search-box,
            .filters-container,
            .print-button,
            .clear-filters-button,
            .description-btn,
            .row-checkbox,
            .checkbox-cell {
                display: none !important;
            }
            
            table {
                page-break-inside: auto;
            }
            
            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
            
            th {
                background: #FF6B6B !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .completed-row {
                background-color: #d4edda !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .print-header {
                display: block !important;
                text-align: center;
                margin: 20px 0;
                padding: 10px;
                border-bottom: 2px solid #667eea;
            }
            
            .print-date {
                display: block !important;
                text-align: left;
                font-size: 0.9rem;
                color: #666;
                margin-bottom: 10px;
            }
        }
        
        .print-header {
            display: none;
        }
        
        .print-date {
            display: none;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1>Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³ØªÙ‡Ø§</h1>
   </div>
   <div class="content">
    <div class="folder-section">
     <div class="folder-left">
      <div class="folder-input-wrapper"><input type="file" id="folderInput" class="folder-input" webkitdirectory directory multiple> <button class="folder-button">ğŸ“‚ Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ´Ù‡</button>
      </div>
      <div id="folderInfo" class="folder-info" style="display: none;"></div>
     </div>
     <div class="folder-right"><span id="cloudStatus" class="status-indicator status-offline">Ø¢ÙÙ„Ø§ÛŒÙ†</span> <button id="refreshData" class="refresh-button" style="display: none;">ğŸ”„ Ø±ÙØ±Ø´</button> <button id="clearData" class="clear-button" style="display: none;">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
     </div>
    </div>
    <div class="files-section">
     <div class="files-header">
      <h2>ğŸ“‹ Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§</h2>
      <div class="filters-container" id="filtersContainer" style="display: none;">
       <div class="filter-group"><label class="filter-label">Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø´Ø±Ø­</label> <input type="text" id="liveSearchBox" class="live-search-box" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø²Ù†Ø¯Ù‡...">
       </div>
       <div class="filter-group"><label class="filter-label">Ø¬Ø³ØªØ¬Ùˆ Ú©Ù„ÛŒ</label> <input type="text" id="searchBox" class="search-box" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù‡Ù…Ù‡...">
       </div>
       <div class="filter-group"><label class="filter-label">ÙˆØ¶Ø¹ÛŒØª</label> <select id="statusFilter" class="filter-select"> <option value="all">Ù‡Ù…Ù‡</option> <option value="completed">Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡</option> <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option> </select>
       </div>
       <div class="filter-group"><label class="filter-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label> <select id="categoryFilter" class="filter-select"> <option value="all">Ù‡Ù…Ù‡</option> <option value="Ø¬Ù†Ø³">Ø¬Ù†Ø³</option> <option value="Ø®Ø¯Ù…Ø§Øª">Ø®Ø¯Ù…Ø§Øª</option> <option value="Ø³Ø§ÛŒØ±">Ø³Ø§ÛŒØ±</option> </select>
       </div>
       <div class="filter-group"><label class="filter-label">Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ</label> <select id="dateRangeFilter" class="filter-select"> <option value="all">Ù‡Ù…Ù‡</option> <option value="today">Ø§Ù…Ø±ÙˆØ²</option> <option value="yesterday">Ø¯ÛŒØ±ÙˆØ²</option> <option value="week">ÛŒÚ© Ù‡ÙØªÙ‡ Ø§Ø®ÛŒØ±</option> <option value="2weeks">Ø¯Ùˆ Ù‡ÙØªÙ‡ Ø§Ø®ÛŒØ±</option> <option value="month">ÛŒÚ© Ù…Ø§Ù‡ Ø§Ø®ÛŒØ±</option> <option value="3months">Ø³Ù‡ Ù…Ø§Ù‡ Ø§Ø®ÛŒØ±</option> <option value="6months">Ø´Ø´ Ù…Ø§Ù‡ Ø§Ø®ÛŒØ±</option> <option value="year">ÛŒÚ© Ø³Ø§Ù„ Ø§Ø®ÛŒØ±</option> </select>
       </div>
       <div class="filter-group"><label class="filter-label" style="opacity: 0;">Ø¹Ù…Ù„ÛŒØ§Øª</label> <button id="clearFilters" class="clear-filters-button">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§</button>
       </div>
       <div class="filter-group"><label class="filter-label" style="opacity: 0;">Ù¾Ø±ÛŒÙ†Øª</label> <button id="printTable" class="print-button"> <span>ğŸ–¨ï¸</span> <span>Ù¾Ø±ÛŒÙ†Øª Ø¬Ø¯ÙˆÙ„</span> </button>
       </div>
      </div>
     </div>
     <div class="table-container">
      <div class="print-date" id="printDate"></div>
      <div class="print-header">
       <h2>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³ØªÙ‡Ø§</h2>
       <p id="printInfo"></p>
      </div>
      <div id="noFiles" class="no-files">
       ğŸ“‚ Ù‡ÛŒÚ† Ù¾ÙˆØ´Ù‡â€ŒØ§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª <br><br>
        Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù¾ÙˆØ´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ <br><br><small>Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø¯Ù†Ø¨Ø§Ù„ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ "Ø¬Ù†Ø³" Ùˆ "Ø®Ø¯Ù…Ø§Øª" Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯</small>
      </div>
      <table id="filesTable" style="display: none;">
       <thead>
        <tr>
         <th class="checkbox-cell">âœ“</th>
         <th onclick="sortTable(0)">Ø±Ø¯ÛŒÙ <span class="sort-indicator" id="sort0"></span></th>
         <th onclick="sortTable(1)">Ø´Ø±Ø­ <span class="sort-indicator" id="sort1"></span></th>
         <th onclick="sortTable(2)">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ <span class="sort-indicator" id="sort2"></span></th>
         <th onclick="sortTable(3)">Ù‚ÛŒÙ…Øª Ø¨Ø±Ø¢ÙˆØ±Ø¯ (Ø±ÛŒØ§Ù„) <span class="sort-indicator" id="sort3"></span></th>
         <th onclick="sortTable(4)">ØªØ§Ø±ÛŒØ® <span class="sort-indicator" id="sort4"></span></th>
         <th class="description-column" onclick="sortTable(5)">ØªÙˆØ¶ÛŒØ­Ø§Øª <span class="sort-indicator" id="sort5"></span></th>
        </tr>
       </thead>
       <tbody id="filesTableBody"></tbody>
      </table>
     </div>
    </div>
   </div>
  </div><!-- Modal for adding descriptions -->
  <div id="descriptionModal" class="description-modal">
   <div class="modal-content">
    <h3>Ø§ÙØ²ÙˆØ¯Ù† ØªÙˆØ¶ÛŒØ­Ø§Øª</h3><textarea id="descriptionText" class="modal-textarea" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
    <div class="modal-buttons"><button id="saveDescription" class="modal-btn save-btn">Ø°Ø®ÛŒØ±Ù‡</button> <button id="cancelDescription" class="modal-btn cancel-btn">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
   </div>
  </div>
  <script>
        let currentFiles = [];
        let sortColumn = 4; // Default sort by date
        let sortDirection = -1; // Descending order (newest first)
        let fileDescriptions = {}; // Ú©Ù„ÛŒØ¯: fullPath ÙØ§ÛŒÙ„ØŒ Ù…Ù‚Ø¯Ø§Ø±: ØªÙˆØ¶ÛŒØ­Ø§Øª
        let completedRows = {}; // Ú©Ù„ÛŒØ¯: fullPath ÙØ§ÛŒÙ„ØŒ Ù…Ù‚Ø¯Ø§Ø±: ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù…ÛŒÙ„
        let currentEditingPath = ''; // Ù…Ø³ÛŒØ± Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´
        let selectedFolderPath = ''; // Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù¾ÙˆØ´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ
        
        // JSONBin.io configuration
        const JSONBIN_CONFIG = {
            binId: '69019eac43b1c97be9890ee2',
            apiKey: '$2a$10$K0GxG/YDDvwcCOicoQSc3OIPqPpUflP5JvKxVStM6sdQYjq4LdXKi',
            baseUrl: 'https://api.jsonbin.io/v3'
        };
        
        // Cloud database functions
        async function saveDataToCloud(data) {
            try {
                updateCloudStatus('saving');
                const response = await fetch(`${JSONBIN_CONFIG.baseUrl}/b/${JSONBIN_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.apiKey
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                updateCloudStatus('online');
                console.log('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ø¨Ø±ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                return true;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ø¨Ø±ÛŒ:', error);
                updateCloudStatus('offline');
                // Fallback to localStorage
                localStorage.setItem('folderData', JSON.stringify(data));
                return false;
            }
        }
        
        async function loadDataFromCloud() {
            try {
                updateCloudStatus('loading');
                const response = await fetch(`${JSONBIN_CONFIG.baseUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.apiKey
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                const folderData = result.record;
                
                if (folderData && folderData.files) {
                    currentFiles = folderData.files;
                    fileDescriptions = folderData.descriptions || {};
                    completedRows = folderData.completed || {};
                    selectedFolderPath = folderData.folderPath || '';
                    
                    // Ù…Ù‡Ø§Ø¬Ø±Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ù‡ ÙØ±Ù…Øª Ø¬Ø¯ÛŒØ¯
                    migrateOldDescriptions();
                    
                    displaySavedFolderInfo(folderData);
                    displayFilesTable();
                    
                    document.getElementById('filtersContainer').style.display = 'flex';
                    
                    updateCloudStatus('online');
                    console.log('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ø¨Ø±ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                } else {
                    // Try loading from localStorage as fallback
                    loadSavedData();
                    updateCloudStatus('offline');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ø¨Ø±ÛŒ:', error);
                updateCloudStatus('offline');
                // Fallback to localStorage
                loadSavedData();
            }
        }
        
        function updateCloudStatus(status) {
            const statusElement = document.getElementById('cloudStatus');
            switch(status) {
                case 'online':
                    statusElement.textContent = 'Ø¢Ù†Ù„Ø§ÛŒÙ†';
                    statusElement.className = 'status-indicator status-online';
                    break;
                case 'offline':
                    statusElement.textContent = 'Ø¢ÙÙ„Ø§ÛŒÙ†';
                    statusElement.className = 'status-indicator status-offline';
                    break;
                case 'loading':
                    statusElement.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...';
                    statusElement.className = 'status-indicator status-offline';
                    break;
                case 'saving':
                    statusElement.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...';
                    statusElement.className = 'status-indicator status-offline';
                    break;
            }
        }
        
        // ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ (index-based) Ø¨Ù‡ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ (path-based)
        function migrateOldDescriptions() {
            let needsMigration = false;
            const newDescriptions = {};
            const newCompleted = {};
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ú©Ù„ÛŒØ¯Ù‡Ø§ Ø¹Ø¯Ø¯ÛŒ Ù‡Ø³ØªÙ†Ø¯ (Ø±ÙˆØ´ Ù‚Ø¯ÛŒÙ…ÛŒ)
            for (const key in fileDescriptions) {
                if (!isNaN(key)) {
                    needsMigration = true;
                    const index = parseInt(key);
                    if (currentFiles[index]) {
                        const fullPath = currentFiles[index].fullPath;
                        newDescriptions[fullPath] = fileDescriptions[key];
                        console.log(`Ù…Ù‡Ø§Ø¬Ø±Øª ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø² index ${key} Ø¨Ù‡ path: ${fullPath}`);
                    }
                } else {
                    newDescriptions[key] = fileDescriptions[key];
                }
            }
            
            // Ù…Ù‡Ø§Ø¬Ø±Øª ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù…ÛŒÙ„
            for (const key in completedRows) {
                if (!isNaN(key)) {
                    needsMigration = true;
                    const index = parseInt(key);
                    if (currentFiles[index]) {
                        const fullPath = currentFiles[index].fullPath;
                        newCompleted[fullPath] = completedRows[key];
                        console.log(`Ù…Ù‡Ø§Ø¬Ø±Øª ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø§Ø² index ${key} Ø¨Ù‡ path: ${fullPath}`);
                    }
                } else {
                    newCompleted[key] = completedRows[key];
                }
            }
            
            if (needsMigration) {
                fileDescriptions = newDescriptions;
                completedRows = newCompleted;
                console.log('Ù…Ù‡Ø§Ø¬Ø±Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³...');
                saveCurrentData();
            }
        }
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø² Ø´Ø¯Ù† ØµÙØ­Ù‡
        window.addEventListener('load', function() {
            loadDataFromCloud();
        });
        
        // Modal event listeners
        document.getElementById('saveDescription').addEventListener('click', saveDescription);
        document.getElementById('cancelDescription').addEventListener('click', closeDescriptionModal);
        
        // Close modal when clicking outside
        document.getElementById('descriptionModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDescriptionModal();
            }
        });
        
        document.getElementById('folderInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù¾ÙˆØ´Ù‡ Ø§Ø² Ø§ÙˆÙ„ÛŒÙ† ÙØ§ÛŒÙ„
                if (files[0].webkitRelativePath) {
                    const fullPath = files[0].webkitRelativePath;
                    const pathParts = fullPath.split('/');
                    
                    // ØªØ´Ø®ÛŒØµ Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù¾ÙˆØ´Ù‡ Ø§Ø² Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„
                    const folderName = pathParts[0];
                    
                    selectedFolderPath = `D:\\${folderName}`;
                    
                    console.log('Ù†Ø§Ù… Ù¾ÙˆØ´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:', folderName);
                    console.log('Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù¾ÙˆØ´Ù‡:', selectedFolderPath);
                    console.log('Ù…Ø³ÛŒØ± Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„:', fullPath);
                }
                processFolderFiles(files);
                saveFolderData(files);
            }
        });
        
        // Auto-refresh folder content on page load
        window.addEventListener('focus', function() {
            refreshFolderContent();
        });
        
        document.getElementById('clearData').addEventListener('click', function() {
            clearAllData();
        });
        
        document.getElementById('refreshData').addEventListener('click', function() {
            refreshFolderData();
        });
        
        document.getElementById('searchBox').addEventListener('input', function(e) {
            filterFiles(e.target.value);
        });
        
        document.getElementById('liveSearchBox').addEventListener('input', function(e) {
            applyFilters();
        });
        
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('categoryFilter').addEventListener('change', applyFilters);
        document.getElementById('dateRangeFilter').addEventListener('change', applyFilters);
        
        document.getElementById('clearFilters').addEventListener('click', function() {
            document.getElementById('searchBox').value = '';
            document.getElementById('liveSearchBox').value = '';
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('categoryFilter').value = 'all';
            document.getElementById('dateRangeFilter').value = 'all';
            applyFilters();
        });
        
        document.getElementById('printTable').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            preparePrintView();
            setTimeout(function() {
                window.print();
            }, 500);
            return false;
        });
        
        // ØªØ§Ø¨Ø¹ ØªØ´Ø®ÛŒØµ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‚ÛŒÙ…Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
        function parseFileName(fileName, category) {
            // Remove file extension
            const nameWithoutExt = fileName.replace(/\.[^/.]+$/, "");
            
            // Ø¨Ø±Ø§ÛŒ Ù¾ÙˆØ´Ù‡ Ø®Ø¯Ù…Ø§Øª: Ø¹Ø¯Ø¯ Ø§ÙˆÙ„ Ù‚ÛŒÙ…Øª Ø§Ø³Øª
            if (category === 'Ø®Ø¯Ù…Ø§Øª') {
                // Extract first number as price
                const firstNumberMatch = nameWithoutExt.match(/(\d+)/);
                if (firstNumberMatch) {
                    const estimatedPrice = parseInt(firstNumberMatch[1]);
                    // Remove the price from description
                    const description = nameWithoutExt.replace(/^\d+\s*-?\s*/, '').trim() || fileName;
                    
                    return {
                        rowNumber: null,
                        estimatedPrice: estimatedPrice,
                        description: description
                    };
                }
            } else {
                // Ø¨Ø±Ø§ÛŒ Ù¾ÙˆØ´Ù‡ Ø¬Ù†Ø³: Ø±ÙˆØ´ Ù‚Ø¨Ù„ÛŒ (Ø´Ù…Ø§Ø±Ù‡ - Ù‚ÛŒÙ…Øª - Ø´Ø±Ø­)
                const numberMatches = nameWithoutExt.match(/^(\d+)(?:\s*-?\s*(\d+))?(.*)$/);
                
                if (numberMatches) {
                    const rowNumber = parseInt(numberMatches[1]);
                    const estimatedPrice = numberMatches[2] ? parseInt(numberMatches[2]) : null;
                    const description = numberMatches[3] ? numberMatches[3].trim().replace(/^[-\s]+/, '') : '';
                    
                    return {
                        rowNumber: rowNumber,
                        estimatedPrice: estimatedPrice,
                        description: description || fileName
                    };
                }
            }
            
            return {
                rowNumber: null,
                estimatedPrice: null,
                description: fileName
            };
        }
        
        function processFolderFiles(files) {
            const oneYearAgo = Date.now() - (365 * 24 * 60 * 60 * 1000);
            
            // Separate files by folder type
            const goodsFiles = [];
            const servicesFiles = [];
            const otherFiles = [];
            
            files.forEach(file => {
                const extension = file.name.split('.').pop().toLowerCase();
                const path = file.webkitRelativePath || file.name;
                
                if (file.lastModified >= oneYearAgo && (extension === 'doc' || extension === 'docx')) {
                    if (path.includes('/Ø¬Ù†Ø³/') || path.includes('/goods/')) {
                        goodsFiles.push(file);
                    } else if (path.includes('/Ø®Ø¯Ù…Ø§Øª/') || path.includes('/services/')) {
                        servicesFiles.push(file);
                    } else {
                        otherFiles.push(file);
                    }
                }
            });
            
            // Combine and sort by modification date (newest first)
            const allFiles = [...goodsFiles, ...servicesFiles, ...otherFiles];
            allFiles.sort((a, b) => b.lastModified - a.lastModified);
            
            currentFiles = allFiles.map((file, index) => {
                const path = file.webkitRelativePath || file.name;
                let category = 'Ø³Ø§ÛŒØ±';
                
                if (path.includes('/Ø¬Ù†Ø³/') || path.includes('/goods/')) {
                    category = 'Ø¬Ù†Ø³';
                } else if (path.includes('/Ø®Ø¯Ù…Ø§Øª/') || path.includes('/services/')) {
                    category = 'Ø®Ø¯Ù…Ø§Øª';
                }
                
                // Parse file name with category-specific logic
                const parsedName = parseFileName(file.name, category);
                
                // Ø³Ø§Ø®Øª Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„
                const fullFilePath = selectedFolderPath ? `${selectedFolderPath}/${path.split('/').slice(1).join('/')}` : path;
                
                return {
                    originalName: file.name,
                    rowNumber: parsedName.rowNumber,
                    description: parsedName.description,
                    estimatedPrice: parsedName.estimatedPrice,
                    lastModified: file.lastModified,
                    category: category,
                    path: path,
                    fullPath: fullFilePath,
                    index: index,
                    file: file
                };
            });
            
            displayFolderInfo(files);
            displayFilesTable();
            
            document.getElementById('filtersContainer').style.display = 'flex';
        }
        
        async function saveFolderData(files) {
            const folderData = {
                folderName: files[0].webkitRelativePath ? files[0].webkitRelativePath.split('/')[0] : 'Ù¾ÙˆØ´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ',
                folderPath: selectedFolderPath,
                timestamp: Date.now(),
                files: currentFiles,
                descriptions: fileDescriptions,
                completed: completedRows
            };
            
            // Save to cloud database first, fallback to localStorage
            await saveDataToCloud(folderData);
        }
        
        function loadSavedData() {
            const savedData = localStorage.getItem('folderData');
            if (savedData) {
                try {
                    const folderData = JSON.parse(savedData);
                    currentFiles = folderData.files;
                    fileDescriptions = folderData.descriptions || {};
                    completedRows = folderData.completed || {};
                    selectedFolderPath = folderData.folderPath || '';
                    
                    // Ù…Ù‡Ø§Ø¬Ø±Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ù‡ ÙØ±Ù…Øª Ø¬Ø¯ÛŒØ¯
                    migrateOldDescriptions();
                    
                    displaySavedFolderInfo(folderData);
                    displayFilesTable();
                    
                    document.getElementById('filtersContainer').style.display = 'flex';
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡:', error);
                }
            }
        }
        
        function refreshFolderContent() {
            // This function would ideally re-read the folder, but due to browser security
            // we can only maintain the existing data and show it
            if (currentFiles.length > 0) {
                displayFilesTable();
            }
        }
        
        function refreshFolderData() {
            // Ø§Ú¯Ø± Ø¢Ø¯Ø±Ø³ Ù¾ÙˆØ´Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø§Ø³ØªØŒ Ø³Ø¹ÛŒ Ø¯Ø± Ø±ÙØ±Ø´ Ù…Ø­ØªÙˆØ§
            if (selectedFolderPath) {
                showInlineMessage('Ø¯Ø± Ø­Ø§Ù„ Ø±ÙØ±Ø´ Ù…Ø­ØªÙˆØ§ÛŒ Ù¾ÙˆØ´Ù‡...', 'success');
                // Re-trigger the folder input to refresh the same folder
                const folderInput = document.getElementById('folderInput');
                folderInput.click();
            } else {
                // Ø§Ú¯Ø± Ø¢Ø¯Ø±Ø³ Ù¾ÙˆØ´Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³ØªØŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ´Ù‡
                showInlineMessage('Ù„Ø·ÙØ§Ù‹ Ù¾ÙˆØ´Ù‡ Ø±Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                const folderInput = document.getElementById('folderInput');
                folderInput.click();
            }
        }
        
        function displayFolderInfo(files) {
            const folderInfo = document.getElementById('folderInfo');
            const clearButton = document.getElementById('clearData');
            const refreshButton = document.getElementById('refreshData');
            
            const folderName = files[0].webkitRelativePath ? files[0].webkitRelativePath.split('/')[0] : 'Ù¾ÙˆØ´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ';
            const goodsCount = currentFiles.filter(f => f.category === 'Ø¬Ù†Ø³').length;
            const servicesCount = currentFiles.filter(f => f.category === 'Ø®Ø¯Ù…Ø§Øª').length;
            const otherCount = currentFiles.filter(f => f.category === 'Ø³Ø§ÛŒØ±').length;
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù¾ÙˆØ´Ù‡
            const fullPathDisplay = selectedFolderPath || `D:\\${folderName}`;
            
            folderInfo.innerHTML = `
                <div style="margin-bottom: 5px;">
                    <strong>ğŸ“ Ù¾ÙˆØ´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:</strong> ${fullPathDisplay}
                </div>
                <div style="font-size: 0.9em; color: #666;">
                    ${currentFiles.length} ÙØ§ÛŒÙ„: ${goodsCount} Ø¬Ù†Ø³ØŒ ${servicesCount} Ø®Ø¯Ù…Ø§ØªØŒ ${otherCount} Ø³Ø§ÛŒØ±
                </div>
            `;
            folderInfo.style.display = 'block';
            clearButton.style.display = 'inline-block';
            refreshButton.style.display = 'inline-block';
        }
        
        function displaySavedFolderInfo(folderData) {
            const folderInfo = document.getElementById('folderInfo');
            const clearButton = document.getElementById('clearData');
            const refreshButton = document.getElementById('refreshData');
            
            const goodsCount = folderData.files.filter(f => f.category === 'Ø¬Ù†Ø³').length;
            const servicesCount = folderData.files.filter(f => f.category === 'Ø®Ø¯Ù…Ø§Øª').length;
            const otherCount = folderData.files.filter(f => f.category === 'Ø³Ø§ÛŒØ±').length;
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù¾ÙˆØ´Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
            const fullPathDisplay = folderData.folderPath || `D:\\${folderData.folderName}`;
            
            folderInfo.innerHTML = `
                <div style="margin-bottom: 5px;">
                    <strong>ğŸ“ Ù¾ÙˆØ´Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡:</strong> ${fullPathDisplay}
                </div>
                <div style="font-size: 0.9em; color: #666;">
                    ${folderData.files.length} ÙØ§ÛŒÙ„: ${goodsCount} Ø¬Ù†Ø³ØŒ ${servicesCount} Ø®Ø¯Ù…Ø§ØªØŒ ${otherCount} Ø³Ø§ÛŒØ±
                </div>
            `;
            folderInfo.style.display = 'block';
            clearButton.style.display = 'inline-block';
            refreshButton.style.display = 'inline-block';
        }
        
        function displayFilesTable(filesToShow = currentFiles) {
            const noFiles = document.getElementById('noFiles');
            const filesTable = document.getElementById('filesTable');
            const tableBody = document.getElementById('filesTableBody');
            
            noFiles.style.display = 'none';
            filesTable.style.display = 'table';
            
            tableBody.innerHTML = '';
            
            filesToShow.forEach((file, index) => {
                const row = document.createElement('tr');
                const isCompleted = completedRows[file.fullPath];
                
                if (isCompleted) {
                    row.classList.add('completed-row');
                }
                
                const categoryColor = file.category === 'Ø¬Ù†Ø³' ? '#28a745' : file.category === 'Ø®Ø¯Ù…Ø§Øª' ? '#007bff' : '#6c757d';
                
                // Create checkbox cell
                const checkboxCell = document.createElement('td');
                checkboxCell.className = 'checkbox-cell';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'row-checkbox';
                checkbox.checked = isCompleted;
                checkbox.addEventListener('change', () => toggleRowCompletion(file.fullPath));
                checkboxCell.appendChild(checkbox);
                
                // Create other cells
                const rowNumberCell = document.createElement('td');
                rowNumberCell.textContent = file.rowNumber !== null ? file.rowNumber : '';
                
                const descCell = document.createElement('td');
                descCell.textContent = 'ğŸ“ ' + file.description;
                
                const categoryCell = document.createElement('td');
                categoryCell.style.color = categoryColor;
                categoryCell.style.fontWeight = 'bold';
                categoryCell.textContent = file.category;
                
                const priceCell = document.createElement('td');
                priceCell.className = 'price-cell';
                priceCell.textContent = file.estimatedPrice !== null ? file.estimatedPrice.toLocaleString('fa-IR') : '';
                
                const dateCell = document.createElement('td');
                dateCell.className = 'file-date';
                dateCell.textContent = formatDate(file.lastModified);
                
                // Create description cell
                const descriptionCell = document.createElement('td');
                descriptionCell.className = 'description-column';
                const descButton = document.createElement('button');
                descButton.className = 'description-btn';
                descButton.textContent = fileDescriptions[file.fullPath] ? 'ÙˆÛŒØ±Ø§ÛŒØ´' : 'Ø§ÙØ²ÙˆØ¯Ù†';
                descButton.addEventListener('click', () => openDescriptionModal(file.fullPath));
                descriptionCell.appendChild(descButton);
                
                if (fileDescriptions[file.fullPath]) {
                    const descPreview = document.createElement('small');
                    descPreview.className = 'description-text';
                    descPreview.style.display = 'block';
                    descPreview.style.marginTop = '5px';
                    const text = fileDescriptions[file.fullPath];
                    descPreview.textContent = text.length > 50 ? text.substring(0, 50) + '...' : text;
                    descPreview.setAttribute('data-fulltext', text); // Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Tooltip
                    descriptionCell.appendChild(document.createElement('br'));
                    descriptionCell.appendChild(descPreview);
                }
                
                // Append all cells to row
                row.appendChild(checkboxCell);
                row.appendChild(rowNumberCell);
                row.appendChild(descCell);
                row.appendChild(categoryCell);
                row.appendChild(priceCell);
                row.appendChild(dateCell);
                row.appendChild(descriptionCell);
                
                tableBody.appendChild(row);
            });
        }
        
        function toggleRowCompletion(filePath) {
            completedRows[filePath] = !completedRows[filePath];
            displayFilesTable();
            saveCurrentData();
        }
        
        function openDescriptionModal(filePath) {
            currentEditingPath = filePath;
            const modal = document.getElementById('descriptionModal');
            const textarea = document.getElementById('descriptionText');
            
            // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² fullPath Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ú©Ù„ÛŒØ¯
            textarea.value = fileDescriptions[filePath] || '';
            modal.style.display = 'flex';
            textarea.focus();
            
            console.log('ÙˆÛŒØ±Ø§ÛŒØ´ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø±Ø§ÛŒ:', filePath);
        }
        
        function closeDescriptionModal() {
            document.getElementById('descriptionModal').style.display = 'none';
            currentEditingPath = '';
        }
        
        function saveDescription() {
            const textarea = document.getElementById('descriptionText');
            const description = textarea.value.trim();
            
            if (currentEditingPath) {
                if (description) {
                    fileDescriptions[currentEditingPath] = description;
                } else {
                    delete fileDescriptions[currentEditingPath];
                }
                
                displayFilesTable();
                saveCurrentData();
            }
            
            closeDescriptionModal();
        }
        
        async function saveCurrentData() {
            if (currentFiles.length > 0) {
                const folderData = {
                    folderName: selectedFolderPath || 'Ù¾ÙˆØ´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ',
                    folderPath: selectedFolderPath,
                    timestamp: Date.now(),
                    files: currentFiles,
                    descriptions: fileDescriptions,
                    completed: completedRows
                };
                
                await saveDataToCloud(folderData);
            }
        }
        
        function getDateRangeTimestamp(rangeValue) {
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;
            
            switch(rangeValue) {
                case 'today':
                    const todayStart = new Date();
                    todayStart.setHours(0, 0, 0, 0);
                    return todayStart.getTime();
                case 'yesterday':
                    const yesterdayStart = new Date();
                    yesterdayStart.setDate(yesterdayStart.getDate() - 1);
                    yesterdayStart.setHours(0, 0, 0, 0);
                    return yesterdayStart.getTime();
                case 'week':
                    return now - (7 * oneDay);
                case '2weeks':
                    return now - (14 * oneDay);
                case 'month':
                    return now - (30 * oneDay);
                case '3months':
                    return now - (90 * oneDay);
                case '6months':
                    return now - (180 * oneDay);
                case 'year':
                    return now - (365 * oneDay);
                default:
                    return null;
            }
        }
        
        function applyFilters() {
            let filteredFiles = [...currentFiles];
            
            // ÙÛŒÙ„ØªØ± Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ù„ÛŒ
            const searchTerm = document.getElementById('searchBox').value.trim();
            if (searchTerm) {
                filteredFiles = filteredFiles.filter(file => 
                    file.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (file.rowNumber && file.rowNumber.toString().includes(searchTerm)) ||
                    (file.estimatedPrice && file.estimatedPrice.toString().includes(searchTerm)) ||
                    file.category.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (fileDescriptions[file.fullPath] && fileDescriptions[file.fullPath].toLowerCase().includes(searchTerm.toLowerCase()))
                );
            }
            
            // ÙÛŒÙ„ØªØ± Ø¬Ø³ØªØ¬ÙˆÛŒ Ø²Ù†Ø¯Ù‡ Ø¯Ø± Ø´Ø±Ø­
            const liveSearchTerm = document.getElementById('liveSearchBox').value.trim();
            if (liveSearchTerm) {
                filteredFiles = filteredFiles.filter(file => 
                    file.description.toLowerCase().includes(liveSearchTerm.toLowerCase())
                );
            }
            
            // ÙÛŒÙ„ØªØ± ÙˆØ¶Ø¹ÛŒØª
            const statusFilter = document.getElementById('statusFilter').value;
            if (statusFilter !== 'all') {
                if (statusFilter === 'completed') {
                    filteredFiles = filteredFiles.filter(file => completedRows[file.fullPath]);
                } else if (statusFilter === 'pending') {
                    filteredFiles = filteredFiles.filter(file => !completedRows[file.fullPath]);
                }
            }
            
            // ÙÛŒÙ„ØªØ± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
            const categoryFilter = document.getElementById('categoryFilter').value;
            if (categoryFilter !== 'all') {
                filteredFiles = filteredFiles.filter(file => file.category === categoryFilter);
            }
            
            // ÙÛŒÙ„ØªØ± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ
            const dateRange = document.getElementById('dateRangeFilter').value;
            if (dateRange !== 'all') {
                const fromTimestamp = getDateRangeTimestamp(dateRange);
                if (fromTimestamp) {
                    filteredFiles = filteredFiles.filter(file => file.lastModified >= fromTimestamp);
                }
            }
            
            displayFilesTable(filteredFiles);
        }
        
        function filterFiles(searchTerm) {
            applyFilters();
        }
        
        function sortTable(columnIndex) {
            if (sortColumn === columnIndex) {
                sortDirection *= -1;
            } else {
                sortColumn = columnIndex;
                sortDirection = 1;
            }
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†Ø´Ø§Ù†Ú¯Ø±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            for (let i = 0; i < 6; i++) {
                document.getElementById(`sort${i}`).textContent = '';
            }
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†Ø´Ø§Ù†Ú¯Ø± Ø¬Ø¯ÛŒØ¯
            document.getElementById(`sort${columnIndex}`).textContent = sortDirection === 1 ? 'â†‘' : 'â†“';
            
            const sortedFiles = [...currentFiles].sort((a, b) => {
                let valueA, valueB;
                
                switch (columnIndex) {
                    case 0: // Ø±Ø¯ÛŒÙ
                        valueA = a.rowNumber;
                        valueB = b.rowNumber;
                        if (valueA === null && valueB === null) return 0;
                        if (valueA === null) return 1;
                        if (valueB === null) return -1;
                        break;
                    case 1: // Ø´Ø±Ø­
                        valueA = a.description.toLowerCase();
                        valueB = b.description.toLowerCase();
                        break;
                    case 2: // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                        valueA = a.category.toLowerCase();
                        valueB = b.category.toLowerCase();
                        break;
                    case 3: // Ù‚ÛŒÙ…Øª Ø¨Ø±Ø¢ÙˆØ±Ø¯
                        valueA = a.estimatedPrice || 0;
                        valueB = b.estimatedPrice || 0;
                        break;
                    case 4: // ØªØ§Ø±ÛŒØ®
                        valueA = a.lastModified;
                        valueB = b.lastModified;
                        break;
                    case 5: // ØªÙˆØ¶ÛŒØ­Ø§Øª
                        valueA = (fileDescriptions[a.fullPath] || '').toLowerCase();
                        valueB = (fileDescriptions[b.fullPath] || '').toLowerCase();
                        break;
                }
                
                if (valueA < valueB) return -1 * sortDirection;
                if (valueA > valueB) return 1 * sortDirection;
                return 0;
            });
            
            displayFilesTable(sortedFiles);
        }
        
        function clearAllData() {
            // Clear cloud data
            const emptyData = {
                folderName: '',
                folderPath: '',
                timestamp: Date.now(),
                files: [],
                descriptions: {},
                completed: {}
            };
            saveDataToCloud(emptyData);
            
            localStorage.removeItem('folderData');
            currentFiles = [];
            fileDescriptions = {};
            completedRows = {};
            selectedFolderPath = '';
            sortColumn = 4;
            sortDirection = -1;
            currentEditingPath = '';
            
            document.getElementById('folderInput').value = '';
            document.getElementById('folderInfo').style.display = 'none';
            document.getElementById('clearData').style.display = 'none';
            document.getElementById('refreshData').style.display = 'none';
            document.getElementById('filesTable').style.display = 'none';
            document.getElementById('noFiles').style.display = 'block';
            document.getElementById('filtersContainer').style.display = 'none';
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†Ø´Ø§Ù†Ú¯Ø±Ù‡Ø§ÛŒ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
            for (let i = 0; i < 6; i++) {
                document.getElementById(`sort${i}`).textContent = '';
            }
            
            closeDescriptionModal();
        }
        
        function getFileExtension(filename) {
            return filename.split('.').pop() || '';
        }
        
        function getFileIcon(extension) {
            const icons = {
                'pdf': 'ğŸ“„',
                'doc': 'ğŸ“', 'docx': 'ğŸ“',
                'xls': 'ğŸ“Š', 'xlsx': 'ğŸ“Š',
                'ppt': 'ğŸ“½ï¸', 'pptx': 'ğŸ“½ï¸',
                'txt': 'ğŸ“ƒ',
                'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸ–¼ï¸', 'bmp': 'ğŸ–¼ï¸',
                'mp4': 'ğŸ¬', 'avi': 'ğŸ¬', 'mov': 'ğŸ¬', 'wmv': 'ğŸ¬',
                'mp3': 'ğŸµ', 'wav': 'ğŸµ', 'flac': 'ğŸµ',
                'zip': 'ğŸ“¦', 'rar': 'ğŸ“¦', '7z': 'ğŸ“¦',
                'html': 'ğŸŒ', 'css': 'ğŸ¨', 'js': 'âš™ï¸',
                'exe': 'âš™ï¸', 'msi': 'âš™ï¸'
            };
            return icons[extension.toLowerCase()] || 'ğŸ“„';
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Ø¨Ø§ÛŒØª';
            const k = 1024;
            const sizes = ['Ø¨Ø§ÛŒØª', 'Ú©ÛŒÙ„ÙˆØ¨Ø§ÛŒØª', 'Ù…Ú¯Ø§Ø¨Ø§ÛŒØª', 'Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('fa-IR') + ' ' + date.toLocaleTimeString('fa-IR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
        
        function preparePrintView() {
            const printDate = document.getElementById('printDate');
            const printInfo = document.getElementById('printInfo');
            
            // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ù¾Ø±ÛŒÙ†Øª
            const now = new Date();
            printDate.textContent = `ØªØ§Ø±ÛŒØ® Ú†Ø§Ù¾: ${now.toLocaleDateString('fa-IR')} - ${now.toLocaleTimeString('fa-IR')}`;
            
            // ØªÙ†Ø¸ÛŒÙ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÛŒÙ„ØªØ±Ù‡Ø§
            let filterInfo = [];
            
            const statusFilter = document.getElementById('statusFilter').value;
            if (statusFilter !== 'all') {
                filterInfo.push(`ÙˆØ¶Ø¹ÛŒØª: ${statusFilter === 'completed' ? 'Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡' : 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±'}`);
            }
            
            const categoryFilter = document.getElementById('categoryFilter').value;
            if (categoryFilter !== 'all') {
                filterInfo.push(`Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ: ${categoryFilter}`);
            }
            
            const dateRange = document.getElementById('dateRangeFilter').value;
            if (dateRange !== 'all') {
                const rangeLabels = {
                    'today': 'Ø§Ù…Ø±ÙˆØ²',
                    'yesterday': 'Ø¯ÛŒØ±ÙˆØ²',
                    'week': 'ÛŒÚ© Ù‡ÙØªÙ‡ Ø§Ø®ÛŒØ±',
                    '2weeks': 'Ø¯Ùˆ Ù‡ÙØªÙ‡ Ø§Ø®ÛŒØ±',
                    'month': 'ÛŒÚ© Ù…Ø§Ù‡ Ø§Ø®ÛŒØ±',
                    '3months': 'Ø³Ù‡ Ù…Ø§Ù‡ Ø§Ø®ÛŒØ±',
                    '6months': 'Ø´Ø´ Ù…Ø§Ù‡ Ø§Ø®ÛŒØ±',
                    'year': 'ÛŒÚ© Ø³Ø§Ù„ Ø§Ø®ÛŒØ±'
                };
                filterInfo.push(`Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ: ${rangeLabels[dateRange]}`);
            }
            
            const searchTerm = document.getElementById('searchBox').value.trim();
            if (searchTerm) {
                filterInfo.push(`Ø¬Ø³ØªØ¬Ùˆ: ${searchTerm}`);
            }
            
            const liveSearchTerm = document.getElementById('liveSearchBox').value.trim();
            if (liveSearchTerm) {
                filterInfo.push(`Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø´Ø±Ø­: ${liveSearchTerm}`);
            }
            
            // Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§
            const visibleRows = document.querySelectorAll('#filesTableBody tr').length;
            filterInfo.push(`ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§: ${visibleRows}`);
            
            printInfo.textContent = filterInfo.length > 1 ? filterInfo.join(' | ') : 'Ù‡Ù…Ù‡ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§';
        }
        
        function showInlineMessage(message, type) {
            // Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ§Ù… Ù…ÙˆÙ‚Øª
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                border-radius: 5px;
                color: white;
                font-weight: bold;
                z-index: 9999;
                background: ${type === 'success' ? '#28a745' : '#dc3545'};
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            `;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            // Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ Ø§Ø² 3 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3000);
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9adbd6b291fc9bf8',t:'MTc2NTY5NTc3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
